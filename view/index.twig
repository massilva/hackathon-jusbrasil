{% extends "base.twig" %}

{% block css %}
    <link rel="stylesheet" href="../view/css/select2.css">
    <link rel="stylesheet" href="../view/css/bootstrap.css">
    <link rel="stylesheet" href="../view/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="../view/css/style.css">
    <link rel="stylesheet" href="../view/css/mobilemenu.css">
    <link rel="stylesheet" href="../view/css/morris.css">
    <link rel="icon" href="../view/images/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../view/images/favicon.ico" type="image/x-icon" />
{% endblock %}

{% block search %}
    <div class="row_1" id="search">
        <div class="container">
            <h3 class="border">Busca</h3>
            <div class="row">
                <form class="form-inline" action="index.php#search" method="get" >
                <article id="busca" class="span12">
                    <div class="form-group span6">
                        <label for="nome" class="span3">Nome, Razão social ou Nome fantasia</label>
                        <input id="nome" name="busca[nome]" class="form-control" type="text">
                    </div>
                    <div class="form-group span4">
                        <label for="cnpj" class="">CNPJ/CPF</label>
                        <input id="cnpj" name="busca[cnpj]" class="form-control" type="text">
                    </div>
                    <div class="form-group span1">
                        <input type="submit" value="Filtrar" class="btn btn_1">
                    </div>
                    <div class="form-group span11">
                       <div class="accordion" id="accordion2">
                            <div class="accordion-group" style="border:0;padding-left:15px;">
                                <div class="accordion-heading">
                                    <a id="lbl_busca" class=" accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne" style="color:gray;
                                    text-decoration: underline;  font-size:15px;">
                                        Busca Avançada
                                    </a>
                                </div>
                                 <div id="collapseOne" class="accordion-body collapse" style="overflow:auto">
                                    <div class="accordion-inner">
                                        <div class="clear-margim span3">
                                           <label for="num_processo" style="padding-left:30px;" class="">N° Processo</label>
                                           <input id="num_processo" name="busca[processo]" class="form-control" type="text" style="width:117px;">
                                        </div>
                                        <div class="btn-group span3" >
                                            <ul class="avancada">
                                                <li>
                                                    <div class="btn-group ">
                                                          <select id="uf" class="dropdown" name="busca[uf]">
                                                                <option value="UF">UF</option>
                                                                <option value="AC">AC</option>
                                                                <option value="AL">AL</option>
                                                                <option value="AM">AM</option>
                                                                <option value="AP">AP</option>
                                                                <option value="BA">BA</option>
                                                                <option value="CE">CE</option>
                                                                <option value="DF">DF</option>
                                                                <option value="ES">ES</option>
                                                                <option value="GO">GO</option>
                                                                <option value="MA">MA</option>
                                                                <option value="MG">MG</option>
                                                                <option value="MS">MS</option>
                                                                <option value="MT">MT</option>
                                                                <option value="PA">PA</option>
                                                                <option value="PB">PB</option>
                                                                <option value="PE">PE</option>
                                                                <option value="PI">PI</option>
                                                                <option value="PR">PR</option>
                                                                <option value="RJ">RJ</option>
                                                                <option value="RN">RN</option>
                                                                <option value="RO">RO</option>
                                                                <option value="RR">RR</option>
                                                                <option value="RS">RS</option>
                                                                <option value="SC">SC</option>
                                                                <option value="SE">SE</option>
                                                                <option value="SP">SP</option>
                                                                <option value="TO">TO</option>
                                                                </select>
                                                        </div>
                                                </li>
                                                <li>
                                                    <div class="btn-group">
                                                         <select id="orgao" class="dropdown" name="busca[orgao]">
                                                            <option value="ORGAO">ORGÃO</option>
                                                            <?php
                                                            foreach ($orgao as $key => $obj){
                                                               echo "<option value='" .utf8_encode($obj->orgao) . "'>".strtoupper(utf8_encode($obj->orgao))."</option>";
                                                            }
                                                            ?>
                                                          </select>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="btn-group ">
                                                         <select style="width:180px;" id="motivo" class="dropdown" name="busca[tipo_sancao]">
                                                            <option value="MOTIVO">MOTIVO</option>
                                                            <?php
                                                            foreach ($tipo_sancao as $key => $obj){
                                                               echo "<option value='" .utf8_encode($obj->tipo_sancao) . "'>" . utf8_encode($obj->tipo_sancao) . "</option>";
                                                            }
                                                            ?>
                                                        </select>
                                                    </div>
                                                </li>    
                                          </ul>
                                     </div>
                               </div>     
                          </div>
                      </div>
                   </div>
                </article>
                <article id="resultado">
                    {# <?php  if(isSet($_GET['busca'])){ ?>
                        <div class="table-responsive span12">
                          <table id="table_resultado" class="table table-striped">
                            <thead>
                            <tr role="row">
                                <th>#</th>
                                <th>Nome</th>
                                <th>CNPJ/CPF</th>
                                <th>UF da Pessoa</th>
                                <th>Tipo de Sanção</th>
                                <th>Data de inicio da Sanção</th>
                                <th>Data de fim da Sanção</th>
                                <th>Orgão Sancionador</th>
                                <th>Origem da Informação</th>
                                <th>Data da Informação</th>
                            <tr>
                            </thead>
                            <tbody>
                                <?php  if(empty($resultado)){
                                    echo "<tr><td colspan='100'>Sem resultado.</td></tr>";
                                }else{
                                    foreach ($resultado as $key => $obj){
                                       echo "<tr>";
                                       echo "<td>".($key+1)."</td>";
                                       echo "<td>".$obj->nome."</td>";
                                       echo "<td>".$obj->cnpj_cpf."</td>";
                                       echo "<td>".$obj->uf_pessoa."</td>";
                                       echo "<td>".utf8_encode($obj->tipo_sancao)."</td>";
                                       echo "<td>".utf8_encode($obj->data_inicio)."</td>";
                                       echo "<td>".utf8_encode($obj->data_fim)."</td>";
                                       echo "<td>".strtoupper(utf8_encode($obj->orgao))."</td>";
                                       echo "<td>".utf8_encode($obj->origem_informacao)."</td>";
                                       echo "<td>".utf8_encode($obj->data_informacao)."</td>";
                                       echo "</tr>";
                                    }
                                }?>
                            </tbody>
                          </table>
                          <?php
                            if(count($resultado) == 100){
                            echo "<a href='index.php?busca[nome]=".$busca['nome']."&busca[cnpj]=".$busca['cnpj']."&busca[processo]=".$busca['processo']."&busca[uf]=".$busca['uf']."&busca[orgao]=".$busca['orgao']."&busca[motivo]=".$busca['motivo']."&l=".($limite+100)."' class='btn btn_1 right'>MAIS +100</a>
                            </div>";
                            } 
                        } //FIM if(isSet($_GET['busca']))
                        ?> #}
             </article>
              </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block graphs %}
    <div class="row_1">
        <div class="container" id="graphs">
            <script type="text/javascript" src="https://www.google.com/jsapi"></script>
            <script type="text/javascript">
                url = document.URL;
                end = url.split("/");
                if(url.indexOf("localhost") == -1){
                    url_base = "";
                }else{
                    url_base = "/"+end[3];
                }

                google.load('visualization', '1', {packages: ['geochart']});
                function drawVisualization() {
                    var data = google.visualization.arrayToDataTable(
                        [
                        ['State','Num. de inidônios'],
                        <?php
                        foreach ($estados as $key => $est){
                            echo "['".$est[0]."',".$est[1]."],";
                        }
                        ?>
                        ]);

                    var geochart = new google.visualization.GeoChart(
                            document.getElementById('map'));
                    geochart.draw(data,{
                        width: 600,
                        colors : ['#FFFFCC', '#FF9900', '#FF0000'],
                        region: "BR", 
                        resolution: "provinces"
                    });
                    google.visualization.events.addListener(geochart, 'select', function() {
                        var selection = geochart.getSelection();
                        var row = selection[0].row;
                        var nomeEstado = data.getValue(row, 0);
                        nomeEstado = nomeEstado.substr(3,2);
                        window.location = url_base+'/index.php?busca[uf]='+nomeEstado+'#search';
                    }); 
                }
                google.setOnLoadCallback(drawVisualization);
            </script>
            <div class="row">
                <h3 class="center border span12">Inidônios por Estado</h3>
                <div id="estados">
                    <div id="map" class="center"></div>
                </div>
                <h6 class="center legend span12">Relação de pessoas inidonia ou suspensa por estado</h6>
            </div>
            <div class="row">
                <h3 class="center border span12">Inidônios por Motivo</h3>
                <article class="span12">
                    <div id="donutGraph"></div>
                </article>
                <script type="text/javascript">
                new Morris.Donut({
                  element: 'donutGraph',
                  data: <?= json_encode($motivo)?>,
                  }); 
                </script>
            </div>
        </div>
    </div>
{% endblock %}

{% block ranking %}
    <div class="row_1" id="ranking">
        <div class="container">
            <h3 class="border">Top Inidônios</h3>
            <div class="row">
                <?php
                foreach ($motivos as $key => $obj){
                ?>
                    <section class="span3 gallery_item gallery_item_<?=($key+1)?>">
                    <figure class="">                           
                        <img src="images/gallery_item_bg<?=($key%2 + 1)?>.png" alt="">
                        <figcaption>                   
                            <p><strong><?=($key+1)?>&deg - </strong><?=$obj->nome?></p>
                            <p>
                            <h5><?=$obj->qtd?> - <?=utf8_encode($obj->tipo_sancao)?></h5>
                            <h2><?=$obj->uf_pessoa?></h2>
                            </p>
                        </figcaption>
                    </figure>
                </section>  
                <?php
                }
                ?>
            </div>
        </div>
    </div>
{% endblock %}

{% block about %}
    <div id="about">
        <div class="map_wrapper">
            <div class="container">
                <h3 class="border">Sobre</h3>
                <div class="center">
                    SISTEMA PARA CONSULTA PUBLICA DE INFORMAÇÕES SOBRE EMPRESAS <br/>INIDÔNEAS E SUSPENSAS EM TODO O TERRITÓRIO NACIONAL.
                </div>
                <div class="row center">
                    <iframe width="560" height="315" src="//www.youtube.com/embed/AK2thtaR-Wc" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
            
{% block scripts %}
     <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
     <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
     <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
     <script type="text/javascript" src="../view/js/jquery.dataTables.js"></script>
     <script type="text/javascript" src="../view/js/select2.js"></script>
     <script type="text/javascript" src="../view/js/bootstrap.js"></script>
     <script type="text/javascript" src="../view/js/jquery.session.js"></script>
     <script type="text/javascript" src="../view/js/parallax.js"></script>
     <script type="text/javascript" src="../view/js/jquery.flexslider.js"></script>
     <script type="text/javascript" src="../view/js/message-form.js"></script>
     <script type="text/javascript" src="../view/js/script.js"></script>    
     <script type="text/javascript" src="../view/js/morris.min.js"></script>        
{% endblock %}